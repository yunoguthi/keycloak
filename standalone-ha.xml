<?xml version="1.0" ?>
<jboss xmlns="urn:jboss:1.0">
  <stacks>
    <stack name="standalone-ha">
      <subsystem xmlns="urn:jboss:domain:keycloak-server:1.1">
        <web-context>auth</web-context>
      </subsystem>
    </stack>
  </stacks>
  <profile>
    <subsystem xmlns="urn:jboss:domain:keycloak-server:1.1"/>
    <subsystem xmlns="urn:jboss:domain:logging:7.0">
      <console-handler name="CONSOLE">
        <level name="INFO"/>
        <formatter>
          <named-formatter name="COLOR-PATTERN"/>
        </formatter>
      </console-handler>
      <periodic-rotating-file-handler name="FILE" autoflush="true">
        <level name="ALL"/>
        <formatter>
          <named-formatter name="PATTERN"/>
        </formatter>
        <file relative-to="jboss.server.log.dir" path="server.log"/>
        <suffix value=".yyyy-MM-dd"/>
        <append value="true"/>
      </periodic-rotating-file-handler>
      <logger category="com.arjuna">
        <level name="WARN"/>
      </logger>
      <logger category="org.apache.tomcat.util.modeler">
        <level name="WARN"/>
      </logger>
      <logger category="org.jboss.as.config">
        <level name="DEBUG"/>
      </logger>
      <logger category="sun.rmi">
        <level name="WARN"/>
      </logger>
      <root-logger>
        <level name="INFO"/>
        <handlers>
          <handler name="CONSOLE"/>
          <handler name="FILE"/>
        </handlers>
      </root-logger>
      <formatter name="PATTERN">
        <pattern-formatter pattern="%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c] (%t) %s%E%n"/>
      </formatter>
      <formatter name="COLOR-PATTERN">
        <pattern-formatter pattern="%K{level}%d{HH:mm:ss,SSS} %-5p [%c] (%t) %s%E%n"/>
      </formatter>
    </subsystem>
    <subsystem xmlns="urn:jboss:domain:undertow:7.0" default-server="default-server" default-virtual-host="default-host" default-servlet-container="default" default-security-domain="other" statistics-enabled="${wildfly.undertow.statistics-enabled:${wildfly.statistics-enabled:false}}">
      <buffer-cache name="default"/>
      <server name="default-server">
        <http-listener name="default" socket-binding="http" redirect-socket="https" enable-http2="true"/>
        <https-listener name="https" socket-binding="https" security-realm="ApplicationRealm" enable-http2="true"/>
        <host name="default-host" alias="localhost">
          <location name="/" handler="welcome-content"/>
          <http-invoker security-realm="ApplicationRealm"/>
        </host>
      </server>
      <servlet-container name="default">
        <jsp-config/>
        <websockets/>
      </servlet-container>
      <handlers>
        <file name="welcome-content" path="${jboss.home.dir}/welcome-content"/>
      </handlers>
    </subsystem>
    <subsystem xmlns="urn:jboss:domain:ejb3:5.0">
      <session-bean>
        <stateless>
          <bean-instance-pool-ref pool-name="slsb-strict-max-pool"/>
        </stateless>
        <singleton>
          <bean-instance-pool-ref pool-name="slsb-strict-max-pool"/>
          <depends>jboss.ejb3:service=EJBTimerService</depends>
        </singleton>
      </session-bean>
      <mdb>
        <resource-adapter-ref resource-adapter-name="${ejb.resource-adapter-name:activemq-ra.rar}"/>
        <bean-instance-pool-ref pool-name="mdb-strict-max-pool"/>
      </mdb>
      <pools>
        <bean-instance-pools>
          <strict-max-pool name="slsb-strict-max-pool" derive-size="from-worker-pools" instance-acquisition-timeout="5" instance-acquisition-timeout-unit="MINUTES"/>
          <strict-max-pool name="mdb-strict-max-pool" derive-size="from-cpu-count" instance-acquisition-timeout="5" instance-acquisition-timeout-unit="MINUTES"/>
        </bean-instance-pools>
      </pools>
      <caches>
        <cache name="ejb" alias="sfsb">
          <alias>stateful session bean</alias>
        </cache>
        <cache name="web" alias="http-session"/>
        <cache name="cmp" alias="entity"/>
      </caches>
      <passivation-store name="file" cache-container="ejb" max-size="20000"/>
      <async thread-pool-name="default"/>
      <timer-service thread-pool-name="default">
        <data-store path="timer-service-data" relative-to="jboss.server.data.dir"/>
      </timer-service>
      <remote connector-ref="http-remoting-connector" thread-pool-name="default"/>
      <thread-pools>
        <thread-pool name="default">
          <max-threads count="100"/>
          <keepalive-time time="100" unit="milliseconds"/>
        </thread-pool>
      </thread-pools>
      <iiop enable-by-default="false" use-qualified-name="false"/>
      <default-security-domain value="other"/>
      <default-missing-method-permissions-deny-access value="true"/>
      <log-system-exceptions value="true"/>
    </subsystem>
    <subsystem xmlns="urn:jboss:domain:infinispan:7.0" default-cache-container="server" aliases="singleton cluster">
      <cache-container name="server" default-cache="default" module="org.wildfly.clustering.server">
        <local-cache name="default">
          <transaction mode="BATCH"/>
        </local-cache>
      </cache-container>
    </subsystem>
    <subsystem xmlns="urn:jboss:domain:batch-jberet:1.0">
      <default-job-repository name="in-memory"/>
      <default-thread-pool name="batch"/>
      <job-repository name="in-memory">
        <in-memory/>
      </job-repository>
      <thread-pool name="batch">
        <max-threads count="10"/>
        <keepalive-time time="30" unit="seconds"/>
      </thread-pool>
    </subsystem>
    <subsystem xmlns="urn:jboss:domain:remoting:3.0">
      <endpoint/>
      <http-connector name="http-remoting-connector" connector-ref="default" security-realm="ApplicationRealm"/>
    </subsystem>
  </profile>
  <interfaces>
    <interface name="management">
      <inet-address value="${jboss.bind.address.management:127.0.0.1}"/>
    </interface>
    <interface name="public">
      <inet-address value="${jboss.bind.address:127.0.0.1}"/>
    </interface>
    <interface name="unsecure">
      <inet-address value="${jboss.bind.address.unsecure:127.0.0.1}"/>
    </interface>
  </interfaces>
  <socket-binding-groups>
    <socket-binding-group name="standard-sockets" default-interface="public" port-offset="${jboss.socket.binding.port-offset:0}">
      <socket-binding name="management-http" interface="management" port="${jboss.management.http.port:9990}"/>
      <socket-binding name="management-https" interface="management" port="${jboss.management.https.port:9993}"/>
      <socket-binding name="ajp" port="${jboss.ajp.port:8009}"/>
      <socket-binding name="http" port="${jboss.http.port:8080}"/>
      <socket-binding name="https" port="${jboss.https.port:8443}"/>
      <socket-binding name="txn-recovery-environment" port="4712"/>
      <socket-binding name="txn-status-manager" port="4713"/>
      <outbound-socket-binding name="mail-smtp">
        <remote-destination host="localhost" port="25"/>
      </outbound-socket-binding>
    </socket-binding-group>
  </socket-binding-groups>
</jboss>
